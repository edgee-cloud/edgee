(()=>{var _={eventPath:"/_edgee/event",methods:["identify","track","page"]},c=_;var k=t=>{let e=window.location.search;return new URLSearchParams(e).get(t)},x=()=>{let t=k("_edgeedebug");if(t!==null){if(t==="true")return localStorage.setItem("_edgeedebug",!0),!0;if(t==="false")return localStorage.setItem("_edgeedebug",!1),!1}let e=localStorage.getItem("_edgeedebug");return e===null?!1:e==="true"},i=(...t)=>{typeof t!="object"&&(t=[t]),console&&typeof console.log=="function"&&x()&&console.log("%cEDGEE","display: inline-block; color: #61d2a3; background: #231A26; padding: 1px 4px; border-radius: 3px;",...t)},l=(...t)=>{typeof t!="object"&&(t=[t]),console&&typeof console.error=="function"&&console.error("%cEDGEE","display: inline-block; color: #CB134A; background: #231A26; padding: 1px 4px; border-radius: 3px;",...t)};function E(t){fetch(c.eventPath,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(e=>{e.status!==200&&e.status!==204?l("Failed to send event to "+c.eventPath+": "+e.status):i("Event sent to "+c.eventPath)}).catch(e=>{l("Failed to send event to "+c.eventPath+": "+e)})}var p=E;var w=0;function s(){let t=document.getElementById("__EDGEE_CONTEXT__");t===null&&w<1&&document.readyState!=="complete"&&(i("Edgee data payload not found, waiting for it to be added to the page"),w++,document.onreadystatechange=()=>{if(document.readyState==="complete")return s()});let e={};if(t!==null){let v=t.textContent;e=JSON.parse(v)}let o=Intl.DateTimeFormat().resolvedOptions().timeZone;o&&(e.client={},e.client.timezone=o);let n=window.screen?window.screen.width:0,r=window.screen?window.screen.height:0;n&&r&&(e.client=e.client||{},e.client.screenWidth=n,e.client.screenHeight=r);let f=window.devicePixelRatio;f&&(e.client=e.client||{},e.client.screenDensity=f);let a=new URLSearchParams(window.location.search);return a.has("utm_campaign")&&(e.campaign=e.campaign||{},e.campaign.name=a.get("utm_campaign")),a.has("utm_source")&&(e.campaign=e.campaign||{},e.campaign.source=a.get("utm_source")),a.has("utm_medium")&&(e.campaign=e.campaign||{},e.campaign.medium=a.get("utm_medium")),a.has("utm_term")&&(e.campaign=e.campaign||{},e.campaign.term=a.get("utm_term")),a.has("utm_content")&&(e.campaign=e.campaign||{},e.campaign.content=a.get("utm_content")),a.has("utm_creative_format")&&(e.campaign=e.campaign||{},e.campaign.creativeFormat=a.get("utm_creative_format")),a.has("utm_marketing_tactic")&&(e.campaign=e.campaign||{},e.campaign.marketingTactic=a.get("utm_marketing_tactic")),e}function P(t){let e=m();if(e.type="page",t.length!==0){let[o,n]=t;typeof o=="string"?e.page.name=o:typeof o=="object"&&(e.page={...e.page,...o}),typeof n=="object"&&(e.destinations={...e.destinations,...n})}i("page event:",e),p(e)}function m(){let t=s(),e;document.querySelector('link[rel="canonical"]')&&document.querySelector('link[rel="canonical"]').getAttribute("href")&&(e=document.querySelector('link[rel="canonical"]').getAttribute("href"),e.indexOf(window.location.protocol+"//"+window.location.host)!==0&&(e=window.location.protocol+"//"+window.location.host+e));let o;if(e){o=e.replace(/^https?:\/\//,"");let n=o.split("/")[0];o=o.replace(n,""),o=o.split("?")[0]}if(t.page=t.page||{},t.page.url||(e?t.page.url=e:t.page.url=window.location.protocol+"//"+window.location.host+window.location.pathname+window.location.search),t.page.path||(o?t.page.path=o:t.page.path=window.location.pathname),!t.page.search&&window.location.search!==""&&(t.page.search=window.location.search),t.page.title||(t.page.title=document.title),!t.page.keywords){let n=document.querySelector('meta[name="keywords"]');if(n){let r=n.getAttribute("content");t.page.keywords=r.split(",").map(f=>f.trim())}}return document.referrer&&(t.page.referrer=document.referrer),t}var u=P;function S(t){let e="Event name is required to track an event";if(t.length===0){l(e);return}let o=m();o.type="track",o.track={};let[n,r]=t;if(typeof n=="string")o.track.name=n;else if(typeof n=="object"){if(!n.name){l(e);return}o.track=n}if(n.name===""){l(e);return}typeof r=="object"&&(o.destinations={...o.destinations,...r}),i("track event:",o),p(o)}var y=S;function j(t){let e=s();if(e.type="identify",t.length!==0){let[o,n]=t;typeof o=="string"?e.identify.userId=o:typeof o=="object"&&(e.identify={...e.identify,...o}),typeof n=="object"&&(e.destinations={...e.destinations,...n})}i("identify event:",e),p(e)}var b=j;var d=window.edgee=window.edgee||[];if(d.load)window.console&&console.error&&console.error("Edgee sdk included twice.");else{for(d.load=!0,d.factory=function(n){return function(){let r=Array.prototype.slice.call(arguments);return A(n,r),d}},g=0;g<c.methods.length;g++)h=c.methods[g],d[h]=d.factory(h);let t=document.currentScript,e=t.getAttribute("data-event-path");e&&(i("Event path set to "+e),c.eventPath=e);let o=t.getAttribute("data-page-event");!o||o!=="false"?(i("Collecting page event client side"),u([])):i("Page event already collected at the edge"),window.dispatchEvent(new Event("edgee:loaded"))}var h,g;function A(t,e){t==="page"?u(e):t==="track"?y(e):t==="identify"&&b(e)}})();
