(()=>{var S={eventPath:"/_edgee/event",fullClientSide:!1,methods:["identify","track","page"]},a=S;var E=t=>{let e=window.location.search;return new URLSearchParams(e).get(t)},y=()=>{let t=E("_edgeedebug");if(t!==null){if(t==="true")return localStorage.setItem("_edgeedebug",!0),!0;if(t==="false")return localStorage.setItem("_edgeedebug",!1),!1}let e=localStorage.getItem("_edgeedebug");return e===null?!1:e==="true"},i=(...t)=>{typeof t!="object"&&(t=[t]),console&&typeof console.log=="function"&&y()&&console.log("%cEDGEE","display: inline-block; color: #61d2a3; background: #231A26; padding: 1px 4px; border-radius: 3px;",...t)},l=(...t)=>{typeof t!="object"&&(t=[t]),console&&typeof console.error=="function"&&y()&&console.error("%cEDGEE","display: inline-block; color: #CB134A; background: #231A26; padding: 1px 4px; border-radius: 3px;",...t)};function k(t){let e=a.eventPath;a.fullClientSide&&typeof localStorage<"u"&&localStorage.getItem("_edgee")&&(e=e+"?e="+localStorage.getItem("_edgee")),fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(o=>{o.status!==200&&o.status!==204?l("Failed to send event to "+a.eventPath+": "+o.status):(i("Event sent to "+a.eventPath),a.fullClientSide&&typeof localStorage<"u"&&o.status===200&&o.json().then(n=>{n.e&&localStorage.setItem("_edgee",n.e)}).catch(n=>{l("Failed to parse response: "+n)}))}).catch(o=>{l("Failed to send event to "+a.eventPath+": "+o)})}var s=k;var w=0;function m(){let t=document.getElementById("__EDGEE_CONTEXT__");t===null&&w<1&&document.readyState!=="complete"&&(i("Edgee data payload not found, waiting for it to be added to the page"),w++,document.onreadystatechange=()=>{if(document.readyState==="complete")return m()});let e={};if(t!==null){let b=t.textContent;e=JSON.parse(b)}let o=Intl.DateTimeFormat().resolvedOptions().timeZone;o&&(e.client={},e.client.timezone=o);let n=window.screen?window.screen.width:0,c=window.screen?window.screen.height:0;n&&c&&(e.client=e.client||{},e.client.screenWidth=n,e.client.screenHeight=c);let d=window.devicePixelRatio;d&&(e.client=e.client||{},e.client.screenDensity=d);let r=new URLSearchParams(window.location.search);return r.has("utm_campaign")&&(e.campaign=e.campaign||{},e.campaign.name=r.get("utm_campaign")),r.has("utm_source")&&(e.campaign=e.campaign||{},e.campaign.source=r.get("utm_source")),r.has("utm_medium")&&(e.campaign=e.campaign||{},e.campaign.medium=r.get("utm_medium")),r.has("utm_term")&&(e.campaign=e.campaign||{},e.campaign.term=r.get("utm_term")),r.has("utm_content")&&(e.campaign=e.campaign||{},e.campaign.content=r.get("utm_content")),r.has("utm_creative_format")&&(e.campaign=e.campaign||{},e.campaign.creativeFormat=r.get("utm_creative_format")),r.has("utm_marketing_tactic")&&(e.campaign=e.campaign||{},e.campaign.marketingTactic=r.get("utm_marketing_tactic")),e}function x(t){let e=f();if(e.type="page",t.length!==0){let[o,n]=t;typeof o=="string"?e.page.name=o:typeof o=="object"&&(e.page={...e.page,...o}),typeof n=="object"&&(e.destinations={...e.destinations,...n})}i("page event:",e),s(e)}function f(){let t=m(),e;document.querySelector('link[rel="canonical"]')&&document.querySelector('link[rel="canonical"]').getAttribute("href")&&(e=document.querySelector('link[rel="canonical"]').getAttribute("href"),!e.startsWith("https://")&&!e.startsWith("http://")&&!e.startsWith("^//")&&(e=window.location.protocol+"//"+window.location.host+e));let o;if(e){o=e.replace(/^https?:\/\//,"");let n=o.split("/")[0];o=o.replace(n,""),o=o.split("?")[0]}if(t.page=t.page||{},t.page.url||(e?t.page.url=e:t.page.url=window.location.protocol+"//"+window.location.host+window.location.pathname+window.location.search),t.page.path||(o?t.page.path=o:t.page.path=window.location.pathname),!t.page.search&&window.location.search!==""&&(t.page.search=window.location.search),t.page.title||(t.page.title=document.title),!t.page.keywords){let n=document.querySelector('meta[name="keywords"]');if(n){let c=n.getAttribute("content");t.page.keywords=c.split(",").map(d=>d.trim())}}return document.referrer&&(t.page.referrer=document.referrer),t}var u=x;function P(t){let e="Event name is required to track an event";if(t.length===0){l(e);return}let o=f();o.type="track",o.track={};let[n,c]=t;if(typeof n=="string")o.track.name=n;else if(typeof n=="object"){if(!n.name){l(e);return}o.track=n}if(n.name===""){l(e);return}typeof c=="object"&&(o.destinations={...o.destinations,...c}),i("track event:",o),s(o)}var v=P;function j(t){let e=f();if(e.type="identify",t.length!==0){let[o,n]=t;typeof o=="string"?e.identify.userId=o:typeof o=="object"&&(e.identify={...e.identify,...o}),typeof n=="object"&&(e.destinations={...e.destinations,...n})}i("identify event:",e),s(e)}var _=j;var p=window.edgee=window.edgee||[];if(p.load)l("Edgee sdk included twice.");else{for(p.load=!0,p.factory=function(n){return function(){let c=Array.prototype.slice.call(arguments);return C(n,c),p}},g=0;g<a.methods.length;g++)h=a.methods[g],p[h]=p.factory(h);let t=document.currentScript,e=t.getAttribute("data-event-path");if(e)i("Event path set to "+e),a.eventPath=e;else{a.fullClientSide=!0;let n=t.src;if(n&&(n.startsWith("http://")||n.startsWith("https://")||n.startsWith("//"))){n=n.replace("https://",""),n=n.replace("http://",""),n=n.replace("^//","");let c=n.split("/")[0];a.eventPath=`https://${c}/_edgee/csevent`,i("Event path set to "+a.eventPath)}}let o=t.getAttribute("data-page-event");!o||o!=="false"?(i("Collecting page event client side",a.fullClientSide&&"(full client side)"),u([])):i("Page event already collected at the edge"),window.dispatchEvent(new Event("edgee:loaded"))}var h,g;function C(t,e){t==="page"?u(e):t==="track"?v(e):t==="identify"&&_(e)}})();
