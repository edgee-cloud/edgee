(()=>{var j=Object.defineProperty;var v=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var _=(t,e,n)=>e in t?j(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,c=(t,e)=>{for(var n in e||(e={}))I.call(e,n)&&_(t,n,e[n]);if(v)for(var n of v(e))A.call(e,n)&&_(t,n,e[n]);return t};var T={eventPath:"/_edgee/event",asThirdPartySdk:!1,methods:["identify","track","page"]},r=T;var D=t=>{let e=window.location.search;return new URLSearchParams(e).get(t)},P=()=>{let t=D("_edgeedebug");if(t!==null){if(t==="true")return localStorage.setItem("_edgeedebug",!0),!0;if(t==="false")return localStorage.setItem("_edgeedebug",!1),!1}let e=localStorage.getItem("_edgeedebug");return e===null?!1:e==="true"},s=(...t)=>{typeof t!="object"&&(t=[t]),console&&typeof console.log=="function"&&P()&&console.log("%cEDGEE","display: inline-block; color: #61d2a3; background: #231A26; padding: 1px 4px; border-radius: 3px;",...t)},g=(...t)=>{typeof t!="object"&&(t=[t]),console&&typeof console.error=="function"&&P()&&console.error("%cEDGEE","display: inline-block; color: #CB134A; background: #231A26; padding: 1px 4px; border-radius: 3px;",...t)};function O(t){let e=r.eventPath;r.asThirdPartySdk&&typeof localStorage!="undefined"&&localStorage.getItem("_edgee")&&(e=e+"?e="+localStorage.getItem("_edgee"));let n=JSON.stringify(t);s("---- "+t.type+" event:",t),fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:n}).then(o=>{o.status!==200&&o.status!==204?g("Failed to send event to "+r.eventPath+": "+o.status):(s("----- Event sent to "+r.eventPath),r.asThirdPartySdk&&typeof localStorage!="undefined"&&o.status===200&&o.json().then(i=>{i.e&&localStorage.setItem("_edgee",i.e)}).catch(i=>{g("Failed to parse response: "+i)}))}).catch(o=>{g("Failed to send event to "+r.eventPath+": "+o)})}var p=O;function d(){return W().then(t=>{let e={};if(t!==null){let m=t.textContent;e=JSON.parse(m)}let n=Intl.DateTimeFormat().resolvedOptions().timeZone;n&&(e.client={},e.client.timezone=n);let o=window.screen?window.screen.width:0,i=window.screen?window.screen.height:0;o&&i&&(e.client=e.client||{},e.client.screenWidth=o,e.client.screenHeight=i);let b=window.devicePixelRatio;b&&(e.client=e.client||{},e.client.screenDensity=b);let a=new URLSearchParams(window.location.search);a.has("utm_campaign")&&(e.campaign=e.campaign||{},e.campaign.name=a.get("utm_campaign")),a.has("utm_source")&&(e.campaign=e.campaign||{},e.campaign.source=a.get("utm_source")),a.has("utm_medium")&&(e.campaign=e.campaign||{},e.campaign.medium=a.get("utm_medium")),a.has("utm_term")&&(e.campaign=e.campaign||{},e.campaign.term=a.get("utm_term")),a.has("utm_content")&&(e.campaign=e.campaign||{},e.campaign.content=a.get("utm_content")),a.has("utm_creative_format")&&(e.campaign=e.campaign||{},e.campaign.creativeFormat=a.get("utm_creative_format")),a.has("utm_marketing_tactic")&&(e.campaign=e.campaign||{},e.campaign.marketingTactic=a.get("utm_marketing_tactic"));let l;document.querySelector('link[rel="canonical"]')&&document.querySelector('link[rel="canonical"]').getAttribute("href")&&(l=document.querySelector('link[rel="canonical"]').getAttribute("href"),!l.startsWith("https://")&&!l.startsWith("http://")&&!l.startsWith("//")&&(l=window.location.protocol+"//"+window.location.host+l));let f;if(l){f=l.replace(/^https?:\/\//,"");let m=f.split("/")[0];f=f.replace(m,""),f=f.split("?")[0]}if(e.page=e.page||{},e.page.url||(l?e.page.url=l:e.page.url=window.location.protocol+"//"+window.location.host+window.location.pathname+window.location.search),e.page.path||(f?e.page.path=f:e.page.path=window.location.pathname),!e.page.search&&window.location.search!==""&&(e.page.search=window.location.search),e.page.title||(e.page.title=document.title),!e.page.keywords){let m=document.querySelector('meta[name="keywords"]');if(m){let S=m.getAttribute("content");e.page.keywords=S.split(",").map(x=>x.trim())}}return document.referrer&&(e.page.referrer=document.referrer),e})}function W(){return new Promise(t=>{function e(){let n=document.getElementById("__EDGEE_CONTEXT__");n!==null?(s("--- Get Edgee context"),t(n)):document.readyState==="complete"?(s("--- No Edgee context"),t(null)):(s("--- Edgee context not found, waiting for document to be ready"),document.onreadystatechange=()=>{document.readyState==="complete"&&e()})}e()})}function C(t){d().then(e=>{if(e.type="page",t.length!==0){let[n,o]=t;typeof n=="string"?e.page.name=n:typeof n=="object"&&(e.page=c(c({},e.page),n)),typeof o=="object"&&(e.destinations=c(c({},e.destinations),o))}p(e)})}var w=C;function q(t){let e="Event name is required to track an event";if(t.length===0){g(e);return}d().then(n=>{n.type="track",n.track={};let[o,i]=t;if(typeof o=="string")n.track.name=o;else if(typeof o=="object"){if(!o.name){g(e);return}n.track=o}if(o.name===""){g(e);return}typeof i=="object"&&(n.destinations=c(c({},n.destinations),i)),p(n)})}var k=q;function F(t){d().then(e=>{if(e.type="identify",t.length!==0){let[n,o]=t;typeof n=="string"?e.identify.userId=n:typeof n=="object"&&(e.identify=c(c({},e.identify),n)),typeof o=="object"&&(e.destinations=c(c({},e.destinations),o))}p(e)})}var E=F;var u=window.edgee=window.edgee||[];if(!u.load){for(u.load=!0,u.factory=function(o){return function(){let i=Array.prototype.slice.call(arguments);return G(o,i),u}},h=0;h<r.methods.length;h++)y=r.methods[h],u[y]=u.factory(y);let t=document.currentScript,e=t.getAttribute("data-event-path");if(e)s("- Event path set to "+e),r.eventPath=e;else{r.asThirdPartySdk=!0;let o=t.src;if(o&&(o.startsWith("http://")||o.startsWith("https://")||o.startsWith("//"))){o=o.replace("https://",""),o=o.replace("http://",""),o=o.replace("^//","");let i=o.split("/")[0];r.eventPath=`https://${i}/_edgee/csevent`,s("- Edgee SDK used as third party. Event path set to "+r.eventPath)}}let n=t.getAttribute("data-page-event");!n||n!=="false"?(s("-- Page event to be collected client side"),w([])):s("-- Page event has been collected at the edge"),window.dispatchEvent(new Event("edgee:loaded"))}var y,h;function G(t,e){t==="page"?w(e):t==="track"?k(e):t==="identify"&&E(e)}})();
